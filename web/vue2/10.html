<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>props | 不吃茶的v李白</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/images/photo.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="Live and Study.">
    <meta name="theme-color" content="#0084ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/images/photo">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.db326a3d.css" as="style"><link rel="preload" href="/assets/js/app.2815bb46.js" as="script"><link rel="preload" href="/assets/js/2.97a53aa9.js" as="script"><link rel="preload" href="/assets/js/101.013d4626.js" as="script"><link rel="prefetch" href="/assets/js/10.dcf4c353.js"><link rel="prefetch" href="/assets/js/100.d5f09228.js"><link rel="prefetch" href="/assets/js/102.d0acfcfb.js"><link rel="prefetch" href="/assets/js/103.9a0181c9.js"><link rel="prefetch" href="/assets/js/104.dbdfdac7.js"><link rel="prefetch" href="/assets/js/105.dc49b0bd.js"><link rel="prefetch" href="/assets/js/106.e8cc9fc1.js"><link rel="prefetch" href="/assets/js/107.56a2b7fb.js"><link rel="prefetch" href="/assets/js/108.5df71e18.js"><link rel="prefetch" href="/assets/js/109.3a63eafc.js"><link rel="prefetch" href="/assets/js/11.c4dd4bed.js"><link rel="prefetch" href="/assets/js/110.adc3338f.js"><link rel="prefetch" href="/assets/js/111.8210fc76.js"><link rel="prefetch" href="/assets/js/112.bff45079.js"><link rel="prefetch" href="/assets/js/113.6be99820.js"><link rel="prefetch" href="/assets/js/12.b4fbb96a.js"><link rel="prefetch" href="/assets/js/13.7c881a52.js"><link rel="prefetch" href="/assets/js/14.4ed02a43.js"><link rel="prefetch" href="/assets/js/15.265c101c.js"><link rel="prefetch" href="/assets/js/16.906321ef.js"><link rel="prefetch" href="/assets/js/17.42cc2e36.js"><link rel="prefetch" href="/assets/js/18.25c64695.js"><link rel="prefetch" href="/assets/js/19.8001a709.js"><link rel="prefetch" href="/assets/js/20.40cd6832.js"><link rel="prefetch" href="/assets/js/21.422c524a.js"><link rel="prefetch" href="/assets/js/22.7db22560.js"><link rel="prefetch" href="/assets/js/23.7e57d7fa.js"><link rel="prefetch" href="/assets/js/24.f8cb2a61.js"><link rel="prefetch" href="/assets/js/25.af6443ed.js"><link rel="prefetch" href="/assets/js/26.52908379.js"><link rel="prefetch" href="/assets/js/27.3bd61421.js"><link rel="prefetch" href="/assets/js/28.8a39e1eb.js"><link rel="prefetch" href="/assets/js/29.10ee8016.js"><link rel="prefetch" href="/assets/js/3.7d8bef29.js"><link rel="prefetch" href="/assets/js/30.3dd40517.js"><link rel="prefetch" href="/assets/js/31.03275af0.js"><link rel="prefetch" href="/assets/js/32.0d752ed8.js"><link rel="prefetch" href="/assets/js/33.1140199a.js"><link rel="prefetch" href="/assets/js/34.dd288bee.js"><link rel="prefetch" href="/assets/js/35.d109a221.js"><link rel="prefetch" href="/assets/js/36.43f309ad.js"><link rel="prefetch" href="/assets/js/37.45fa1ae9.js"><link rel="prefetch" href="/assets/js/38.274113de.js"><link rel="prefetch" href="/assets/js/39.0030c2e2.js"><link rel="prefetch" href="/assets/js/4.c510a863.js"><link rel="prefetch" href="/assets/js/40.06f1ded9.js"><link rel="prefetch" href="/assets/js/41.a9d5d598.js"><link rel="prefetch" href="/assets/js/42.ebb4a599.js"><link rel="prefetch" href="/assets/js/43.ae315192.js"><link rel="prefetch" href="/assets/js/44.659ab12f.js"><link rel="prefetch" href="/assets/js/45.6158f93d.js"><link rel="prefetch" href="/assets/js/46.9553bc7e.js"><link rel="prefetch" href="/assets/js/47.24a01113.js"><link rel="prefetch" href="/assets/js/48.1c4616e5.js"><link rel="prefetch" href="/assets/js/49.fc9bf987.js"><link rel="prefetch" href="/assets/js/5.23cd88df.js"><link rel="prefetch" href="/assets/js/50.407a93f3.js"><link rel="prefetch" href="/assets/js/51.aae6cc44.js"><link rel="prefetch" href="/assets/js/52.ac0da788.js"><link rel="prefetch" href="/assets/js/53.15a1bf24.js"><link rel="prefetch" href="/assets/js/54.91ebab9c.js"><link rel="prefetch" href="/assets/js/55.1f5f720b.js"><link rel="prefetch" href="/assets/js/56.080b2ee5.js"><link rel="prefetch" href="/assets/js/57.7b6c3f0f.js"><link rel="prefetch" href="/assets/js/58.84cf0828.js"><link rel="prefetch" href="/assets/js/59.cefc33c8.js"><link rel="prefetch" href="/assets/js/6.771f86e0.js"><link rel="prefetch" href="/assets/js/60.63e88fa8.js"><link rel="prefetch" href="/assets/js/61.c63c1bb2.js"><link rel="prefetch" href="/assets/js/62.84af953a.js"><link rel="prefetch" href="/assets/js/63.445a5766.js"><link rel="prefetch" href="/assets/js/64.3af7f0ef.js"><link rel="prefetch" href="/assets/js/65.c1a4eb22.js"><link rel="prefetch" href="/assets/js/66.96bb7c0e.js"><link rel="prefetch" href="/assets/js/67.25dd973f.js"><link rel="prefetch" href="/assets/js/68.6d273358.js"><link rel="prefetch" href="/assets/js/69.6e92fb34.js"><link rel="prefetch" href="/assets/js/7.b27240dc.js"><link rel="prefetch" href="/assets/js/70.09caea64.js"><link rel="prefetch" href="/assets/js/71.ac25a4dd.js"><link rel="prefetch" href="/assets/js/72.92ff6d6b.js"><link rel="prefetch" href="/assets/js/73.e3a2e52d.js"><link rel="prefetch" href="/assets/js/74.65261390.js"><link rel="prefetch" href="/assets/js/75.a9057ae9.js"><link rel="prefetch" href="/assets/js/76.09073b6d.js"><link rel="prefetch" href="/assets/js/77.ed1b10d4.js"><link rel="prefetch" href="/assets/js/78.4b2a83ed.js"><link rel="prefetch" href="/assets/js/79.1d46c44c.js"><link rel="prefetch" href="/assets/js/8.dcc2e69d.js"><link rel="prefetch" href="/assets/js/80.1bcb0381.js"><link rel="prefetch" href="/assets/js/81.01f51007.js"><link rel="prefetch" href="/assets/js/82.838df9f0.js"><link rel="prefetch" href="/assets/js/83.aa48cd8d.js"><link rel="prefetch" href="/assets/js/84.87da90bd.js"><link rel="prefetch" href="/assets/js/85.d41d9e87.js"><link rel="prefetch" href="/assets/js/86.7aeea46b.js"><link rel="prefetch" href="/assets/js/87.35f82ace.js"><link rel="prefetch" href="/assets/js/88.05bf72f7.js"><link rel="prefetch" href="/assets/js/89.407aee92.js"><link rel="prefetch" href="/assets/js/9.10f27efa.js"><link rel="prefetch" href="/assets/js/90.13fcc480.js"><link rel="prefetch" href="/assets/js/91.658107a6.js"><link rel="prefetch" href="/assets/js/92.1c086b75.js"><link rel="prefetch" href="/assets/js/93.940197a5.js"><link rel="prefetch" href="/assets/js/94.353ddc7f.js"><link rel="prefetch" href="/assets/js/95.310160cc.js"><link rel="prefetch" href="/assets/js/96.904274c6.js"><link rel="prefetch" href="/assets/js/97.2687245b.js"><link rel="prefetch" href="/assets/js/98.5c8e156d.js"><link rel="prefetch" href="/assets/js/99.132de7df.js">
    <link rel="stylesheet" href="/assets/css/0.styles.db326a3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">不吃茶的v李白</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/after/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="https://raindays.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  心情小镇
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Mood" target="_blank" rel="noopener noreferrer" class="nav-link external">
  全栈项目
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/after/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="https://raindays.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  心情小镇
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Mood" target="_blank" rel="noopener noreferrer" class="nav-link external">
  全栈项目
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>CSS</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/CSS/1.html" class="sidebar-link">CSS 世界</a></li><li><a href="/web/CSS/2.html" class="sidebar-link">BFC 浮动</a></li><li><a href="/web/CSS/3.html" class="sidebar-link">盒子模型</a></li><li><a href="/web/CSS/4.html" class="sidebar-link">页面布局</a></li><li><a href="/web/CSS/5.html" class="sidebar-link">选择器</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS 深入数组</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS 对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS 字符串</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>this 闭包 原型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>异步方法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>稀奇古怪的题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>正则</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="props"><a href="#props" class="header-anchor">#</a> props</h1> <p>这一次，通过源码阅读，主要探索的方面包括如何初始化 Props、以及如何进行更新。</p> <h2 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>_watchers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initProps</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> propsOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> propsData <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 获取Vue实例选项上的Props</span>
    <span class="token keyword">var</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 获取挂载Vue实例上的_props</span>
    <span class="token keyword">var</span> keys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Props的Key值组成的数组</span>
    <span class="token comment">// ...</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> propsOptions<span class="token punctuation">)</span> <span class="token function">loop</span><span class="token punctuation">(</span> key <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 循环遍历 vue 实例选项中Props，并且执行响应式处理以及挂载在对应实例上</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>初始化 Props 的关键点就在于loop函数，让我们接着该函数做了什么事情。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> sharedPropertyDefinition <span class="token operator">=</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span><span class="token operator">:</span> noop<span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token operator">:</span> noop
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">proxy</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> sourceKey<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxyGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxySetter</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">key</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每遍历一次Props中的值，都会收集其Key</span>
  <span class="token comment">// ...</span>
  <span class="token function">defineReactive$$1</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 将Vue实例上对象的_props中每一项属性都设置响应式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isUpdatingChildComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 配置的Setter函数，避免子组件直接操作Props的警告</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">&quot;Avoid mutating a prop directly since the value will be &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;overwritten whenever the parent component re-renders. &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;Instead, use a data or computed property based on the prop's &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;value. Prop being mutated: \&quot;&quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;\&quot;&quot;</span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// static props are already proxied on the component's prototype</span>
  <span class="token comment">// during Vue.extend(). We only need to proxy props defined at</span>
  <span class="token comment">// instantiation here.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 遍历时若发现新属性时，就将新属性重新挂载到Vue实例的_props中</span>
    <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&quot;_props&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>理解上应该不会有太大的问题，loop函数中主要做了以下几件事：</p> <ul><li>defineReactive</li></ul> <p>相信对这个函数应该都不会陌生，其实就是对Vue实例上的<code>_props</code>对象中每一个属性都配置成响应式的，这样一来，当父组件中传递进来的 <code>Props</code> 变化时，则会通知相应的子组件中更新函数进行更新；</p> <ul><li>对相应的子组件配置Props属性的Setter警告函数</li></ul> <p>用过Vue的童鞋们应该都会遇到直接更改一个 <code>Props</code> 中的属性时，会抛出一个警告。而这个警告就是在 Vue 遍历 <code>_props</code> 对象中的值时，都会默认配置一个警告 <code>Setter</code> 函数；</p> <ul><li>proxy</li></ul> <p>在遍历的过程中，一旦发现有新的属性时，都会将新属性重新挂载到 Vue 实例的 <code>_props</code> 中。这里有一个很重要的知识点，<strong>当我们直接访问一个 Props 中的属性时，即上面栗子中<code>this.name</code>，其实是直接访问了 Vue 实例的 <code>_props</code> 对象中值而已。</strong></p> <p>至此，我们也知道 Vue 源码是如何实现初始化 Props 的了，那么，究竟是父组件是如何通知更新 Props 的呢？我们接着看下去。</p> <h2 id="更新"><a href="#更新" class="header-anchor">#</a> 更新</h2> <p>由于父组件在更新的过程中，会通知子组件也进行更新，这时候就会调取一个方法<code>updateChildComponent</code>，而这个方法里就会对 <code>Props</code> 进行更新。我们就来看看是如何处理的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">updateChildComponent</span><span class="token punctuation">(</span>
  child<span class="token punctuation">,</span>
  options<span class="token punctuation">.</span>propsData<span class="token punctuation">,</span> <span class="token comment">// updated props</span>
  options<span class="token punctuation">.</span>listeners<span class="token punctuation">,</span> <span class="token comment">// updated listeners</span>
  vnode<span class="token punctuation">,</span> <span class="token comment">// new parent vnode</span>
  options<span class="token punctuation">.</span>children <span class="token comment">// new children</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">updateChildComponent</span> <span class="token punctuation">(</span>
 <span class="token parameter">vm<span class="token punctuation">,</span>
 propsData<span class="token punctuation">,</span>
 listeners<span class="token punctuation">,</span>
 parentVnode<span class="token punctuation">,</span>
 renderChildren</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// ...</span>
   <span class="token comment">// update props</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>propsData <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭依赖监听</span>
     <span class="token keyword">var</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props<span class="token punctuation">;</span> <span class="token comment">// 获取Vue实例上_props对象</span>
     <span class="token keyword">var</span> propKeys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 获取保留在Vue实例上的props key值</span>
     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> propKeys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 循环遍历props key</span>
       <span class="token keyword">var</span> key <span class="token operator">=</span> propKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token keyword">var</span> propOptions <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props<span class="token punctuation">;</span> <span class="token comment">// wtf flow?</span>
       props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先校验Props中定义的数据类型是否符合，符合的话就直接返回，并且直接赋值给Vue实例上_props对象中相应的属性中</span>
     <span class="token punctuation">}</span>
     <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打开依赖监听</span>
     <span class="token comment">// keep a copy of raw propsData</span>
     vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">=</span> propsData<span class="token punctuation">;</span> <span class="token comment">// 新的PropsData直接取替掉选项中旧的PropsData</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// ...</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>一开始看到这里代码时，我是懵逼状态的，因为很容易绕不出来 😂。。在这里面会有几个问题，分别是：</p> <ul><li>validateProp 作用究竟是什么？</li></ul> <p>相信用过 Props 的同学都清楚，在传递给子组件时，子组件中是有权限决定传递的值类型的，大大提高传递的规范，举个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code>props<span class="token operator">:</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    required<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码很好理解，就是规定 <code>name</code> 属性的类型以及是否必传。而方法<code>validateProp</code>作用就是校验父组件传递给子组件的值是否按要求传递，若正确传递则直接赋值给 <code>_props</code> 对象上相应的属性。</p> <ul><li>校验通过后，直接赋值给 <code>_props</code> 对象上相应的属性的用意何在？</li></ul> <p>上面提到过，<code>_props</code> 对象上的每一个属性都会使用 <code>proxy</code> 方法进行响应式挂载。那么当我直接赋值到 <code>_props</code> 对象上相应的属性时，就会触发到其 <code>Setter</code> 函数进行相应的依赖更新。因此，当父组件更新一个传递到子组件的属性时，首先会触发其 <code>Setter</code> 函数通知父组件进行更新，然后通过渲染函数传递到子组件后，更新子组件中的 <code>Props</code>。这时候，由于此时的 <code>Props</code> 对象中的属性收集到了子组件的依赖，更改后会通知相应的依赖进行更新。</p> <ul><li>toggleObserving 究竟是干嘛用的？</li></ul> <p>首先它是一个递归遍历方法，<strong><code>Props</code> 在通知子组件依赖更新时，必须搞清楚的一点，就是是整个值的变化来进行通知</strong>。如何理解？</p> <p>简单滴说，对于属性值为基本数据类型的，当值改变时，是可以直接通知子组件进行更新的，而对于复杂数据类型来说，在更新时，会递归遍历其对象内部的属性来通知相应的依赖进行更新。</p> <p>那么当调用方法<code>toggleObserving</code>为 false 时，对于基础数据类型来说，当其值变化时则直接通知子组件更新，而对于其复杂数据类型来说，则不会递归下去，而只会监听整个复杂数据类型替换时，才会去通知子组件进行更新。因此在 <code>Props</code> 中所有属性通知完后，又会重新调用方法toggleObserving为 true 来打开递归开关。（真的不得不服尤大大啊，这么好的优化思路都能想出来，牛人 👍）</p> <p>至此，你大概也知道整个更新流程了，但是我当时还是存在疑惑的，既然基础数据类型值更改或复杂数据类型整个值更改，可以直接通知到子组件进行更新，那么是否会有一种情况就是，复杂数据类型中属性更改时，又是如何通知子组件更新的呢？？🤔</p> <p>首先，我们一开始已经忽略一个方法，那就是defineReactive$$1，这个方法真的用的秒，可以看看上面的代码，在初始化 Props 时候，会对 Props 每一项的属性进行使用该方法进行响应式的处理，包括了复杂数据类型的中属性，此时该属性不但收集了父组件依赖，还收集了子组件的依赖，这样一来，当复杂数据类型中属性变化时，会先通知父组件更新，再通知子组件进行更新。（这时候我真的不得不服到五体投地。。。）</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ul><li>当 Props 中属性为基础数据类型值更改或复杂数据类型替换时，会通过 Setter 函数通知父组件进行更新，然后通过渲染函数，传递到子组件中更新其 Props 中对象相应的值，这时候就会触发到相应值的 Setter 来通知子组件进行更新；</li> <li>当 Props 中属性为复杂数据类型的属性更改时，由于使用defineReactive$$1方法收集到了父组件依赖以及子组件的依赖，这时候会先通知父组件进行更新，再通知子组件进行更新；</li></ul> <p>参考:</p> <ul><li><a href="https://ustbhuangyi.github.io/vue-analysis/v2/reactive/props.html" target="_blank" rel="noopener noreferrer">Vue.js 技术揭秘 props<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/Andraw-lin/about-Vue/blob/master/docs/%E3%80%90%20Vue%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E3%80%91%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E4%B9%8B%20Props.md" target="_blank" rel="noopener noreferrer">【 Vue 源码分析 】运行机制之 Props<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2815bb46.js" defer></script><script src="/assets/js/2.97a53aa9.js" defer></script><script src="/assets/js/101.013d4626.js" defer></script>
  </body>
</html>
