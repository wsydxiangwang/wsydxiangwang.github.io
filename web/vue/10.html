<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>props | 不吃茶的v李白</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/images/photo.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="Live and Study.">
    <meta name="theme-color" content="#0084ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/images/photo">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.db326a3d.css" as="style"><link rel="preload" href="/assets/js/app.17eeb65b.js" as="script"><link rel="preload" href="/assets/js/2.d133068f.js" as="script"><link rel="preload" href="/assets/js/136.7ab11e16.js" as="script"><link rel="prefetch" href="/assets/js/10.1906940a.js"><link rel="prefetch" href="/assets/js/100.71e0e601.js"><link rel="prefetch" href="/assets/js/101.bc9bd6fe.js"><link rel="prefetch" href="/assets/js/102.6ac95a8f.js"><link rel="prefetch" href="/assets/js/103.b7de3d0a.js"><link rel="prefetch" href="/assets/js/104.28025608.js"><link rel="prefetch" href="/assets/js/105.342ab40a.js"><link rel="prefetch" href="/assets/js/106.94548e98.js"><link rel="prefetch" href="/assets/js/107.58c6c895.js"><link rel="prefetch" href="/assets/js/108.902bfe92.js"><link rel="prefetch" href="/assets/js/109.1cf94752.js"><link rel="prefetch" href="/assets/js/11.5db21d5f.js"><link rel="prefetch" href="/assets/js/110.885d30df.js"><link rel="prefetch" href="/assets/js/111.8ccd6e8f.js"><link rel="prefetch" href="/assets/js/112.d10e2448.js"><link rel="prefetch" href="/assets/js/113.b7b72a78.js"><link rel="prefetch" href="/assets/js/114.59b6a745.js"><link rel="prefetch" href="/assets/js/115.3658688e.js"><link rel="prefetch" href="/assets/js/116.e1c7a95d.js"><link rel="prefetch" href="/assets/js/117.6bf6a450.js"><link rel="prefetch" href="/assets/js/118.91b6eb6f.js"><link rel="prefetch" href="/assets/js/119.e9a4a27b.js"><link rel="prefetch" href="/assets/js/12.2ffd22ab.js"><link rel="prefetch" href="/assets/js/120.f6b1e079.js"><link rel="prefetch" href="/assets/js/121.4823e915.js"><link rel="prefetch" href="/assets/js/122.5a6d639e.js"><link rel="prefetch" href="/assets/js/123.ccdb0115.js"><link rel="prefetch" href="/assets/js/124.6b73173b.js"><link rel="prefetch" href="/assets/js/125.9642bec5.js"><link rel="prefetch" href="/assets/js/126.0128bd5a.js"><link rel="prefetch" href="/assets/js/127.9616e035.js"><link rel="prefetch" href="/assets/js/128.bf329072.js"><link rel="prefetch" href="/assets/js/129.b790c795.js"><link rel="prefetch" href="/assets/js/13.5a8a1247.js"><link rel="prefetch" href="/assets/js/130.40e5c553.js"><link rel="prefetch" href="/assets/js/131.16a3e39f.js"><link rel="prefetch" href="/assets/js/132.13069fbf.js"><link rel="prefetch" href="/assets/js/133.9acb6766.js"><link rel="prefetch" href="/assets/js/134.29631dfa.js"><link rel="prefetch" href="/assets/js/135.f620e0a1.js"><link rel="prefetch" href="/assets/js/137.dfd14c51.js"><link rel="prefetch" href="/assets/js/138.999e6a8b.js"><link rel="prefetch" href="/assets/js/139.466957d8.js"><link rel="prefetch" href="/assets/js/14.cba7f28a.js"><link rel="prefetch" href="/assets/js/140.ef34c025.js"><link rel="prefetch" href="/assets/js/141.509b620b.js"><link rel="prefetch" href="/assets/js/142.270a3c55.js"><link rel="prefetch" href="/assets/js/143.f271f9bd.js"><link rel="prefetch" href="/assets/js/144.b1dfc173.js"><link rel="prefetch" href="/assets/js/145.34170eef.js"><link rel="prefetch" href="/assets/js/146.557dc7ee.js"><link rel="prefetch" href="/assets/js/147.bf54b78f.js"><link rel="prefetch" href="/assets/js/148.ba992b94.js"><link rel="prefetch" href="/assets/js/149.36c4b971.js"><link rel="prefetch" href="/assets/js/15.95a93236.js"><link rel="prefetch" href="/assets/js/150.ec728478.js"><link rel="prefetch" href="/assets/js/151.cdf50e61.js"><link rel="prefetch" href="/assets/js/152.838f33fe.js"><link rel="prefetch" href="/assets/js/153.003521c4.js"><link rel="prefetch" href="/assets/js/154.1144b8dd.js"><link rel="prefetch" href="/assets/js/155.42d686f4.js"><link rel="prefetch" href="/assets/js/156.600af324.js"><link rel="prefetch" href="/assets/js/157.513ae28d.js"><link rel="prefetch" href="/assets/js/158.6ffce870.js"><link rel="prefetch" href="/assets/js/16.f46eecb8.js"><link rel="prefetch" href="/assets/js/17.13c999e7.js"><link rel="prefetch" href="/assets/js/18.2585ae9b.js"><link rel="prefetch" href="/assets/js/19.d3d7cc0c.js"><link rel="prefetch" href="/assets/js/20.c6fa1afe.js"><link rel="prefetch" href="/assets/js/21.7d9937ed.js"><link rel="prefetch" href="/assets/js/22.b34be359.js"><link rel="prefetch" href="/assets/js/23.fed3f594.js"><link rel="prefetch" href="/assets/js/24.6cb3fc33.js"><link rel="prefetch" href="/assets/js/25.0d3747f4.js"><link rel="prefetch" href="/assets/js/26.501d1a7e.js"><link rel="prefetch" href="/assets/js/27.0ffc7a01.js"><link rel="prefetch" href="/assets/js/28.a3070fd6.js"><link rel="prefetch" href="/assets/js/29.02e3dc90.js"><link rel="prefetch" href="/assets/js/3.b2199dbe.js"><link rel="prefetch" href="/assets/js/30.db53684b.js"><link rel="prefetch" href="/assets/js/31.02714568.js"><link rel="prefetch" href="/assets/js/32.90c38613.js"><link rel="prefetch" href="/assets/js/33.e690970e.js"><link rel="prefetch" href="/assets/js/34.91319f90.js"><link rel="prefetch" href="/assets/js/35.00d78b55.js"><link rel="prefetch" href="/assets/js/36.ba0dd9c6.js"><link rel="prefetch" href="/assets/js/37.856224f6.js"><link rel="prefetch" href="/assets/js/38.c4e8c48d.js"><link rel="prefetch" href="/assets/js/39.e5d237e2.js"><link rel="prefetch" href="/assets/js/4.ec3f1421.js"><link rel="prefetch" href="/assets/js/40.ab1fcf95.js"><link rel="prefetch" href="/assets/js/41.8b5a0d04.js"><link rel="prefetch" href="/assets/js/42.e34244a2.js"><link rel="prefetch" href="/assets/js/43.b56c9acd.js"><link rel="prefetch" href="/assets/js/44.91c489fa.js"><link rel="prefetch" href="/assets/js/45.be1c46eb.js"><link rel="prefetch" href="/assets/js/46.61fdb9bf.js"><link rel="prefetch" href="/assets/js/47.b5be4d04.js"><link rel="prefetch" href="/assets/js/48.d5c6cc97.js"><link rel="prefetch" href="/assets/js/49.67225bce.js"><link rel="prefetch" href="/assets/js/5.753f9461.js"><link rel="prefetch" href="/assets/js/50.8d2860aa.js"><link rel="prefetch" href="/assets/js/51.89edcb76.js"><link rel="prefetch" href="/assets/js/52.1374575e.js"><link rel="prefetch" href="/assets/js/53.087d301a.js"><link rel="prefetch" href="/assets/js/54.2858754a.js"><link rel="prefetch" href="/assets/js/55.ff5713c5.js"><link rel="prefetch" href="/assets/js/56.f1f633d1.js"><link rel="prefetch" href="/assets/js/57.8e816a9f.js"><link rel="prefetch" href="/assets/js/58.1df2dbf0.js"><link rel="prefetch" href="/assets/js/59.fa27fce7.js"><link rel="prefetch" href="/assets/js/6.4afc9a75.js"><link rel="prefetch" href="/assets/js/60.dcbfe0cf.js"><link rel="prefetch" href="/assets/js/61.5965371a.js"><link rel="prefetch" href="/assets/js/62.d7d1fa9e.js"><link rel="prefetch" href="/assets/js/63.4135207e.js"><link rel="prefetch" href="/assets/js/64.5f4237e6.js"><link rel="prefetch" href="/assets/js/65.0eed8492.js"><link rel="prefetch" href="/assets/js/66.5b08dfe2.js"><link rel="prefetch" href="/assets/js/67.028aab7c.js"><link rel="prefetch" href="/assets/js/68.a7581899.js"><link rel="prefetch" href="/assets/js/69.76dad9d3.js"><link rel="prefetch" href="/assets/js/7.a670f9c1.js"><link rel="prefetch" href="/assets/js/70.122094ee.js"><link rel="prefetch" href="/assets/js/71.f300d523.js"><link rel="prefetch" href="/assets/js/72.7097e3d3.js"><link rel="prefetch" href="/assets/js/73.77044a00.js"><link rel="prefetch" href="/assets/js/74.5ffd47ef.js"><link rel="prefetch" href="/assets/js/75.8324d633.js"><link rel="prefetch" href="/assets/js/76.af41d1e8.js"><link rel="prefetch" href="/assets/js/77.c6f565b0.js"><link rel="prefetch" href="/assets/js/78.19d492b7.js"><link rel="prefetch" href="/assets/js/79.21367513.js"><link rel="prefetch" href="/assets/js/8.9fb777e4.js"><link rel="prefetch" href="/assets/js/80.91fad6af.js"><link rel="prefetch" href="/assets/js/81.5768445b.js"><link rel="prefetch" href="/assets/js/82.19da4651.js"><link rel="prefetch" href="/assets/js/83.775ebeef.js"><link rel="prefetch" href="/assets/js/84.45430808.js"><link rel="prefetch" href="/assets/js/85.fc43b2d5.js"><link rel="prefetch" href="/assets/js/86.17d50c9e.js"><link rel="prefetch" href="/assets/js/87.c1742c81.js"><link rel="prefetch" href="/assets/js/88.1599bb8b.js"><link rel="prefetch" href="/assets/js/89.02e7c0c9.js"><link rel="prefetch" href="/assets/js/9.41aea720.js"><link rel="prefetch" href="/assets/js/90.635751bf.js"><link rel="prefetch" href="/assets/js/91.79af5630.js"><link rel="prefetch" href="/assets/js/92.cc2503a1.js"><link rel="prefetch" href="/assets/js/93.0c98909a.js"><link rel="prefetch" href="/assets/js/94.35c7829e.js"><link rel="prefetch" href="/assets/js/95.9e6ad272.js"><link rel="prefetch" href="/assets/js/96.7d0e5cda.js"><link rel="prefetch" href="/assets/js/97.f58d77fc.js"><link rel="prefetch" href="/assets/js/98.226f8516.js"><link rel="prefetch" href="/assets/js/99.a3852c3f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.db326a3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">不吃茶的v李白</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/after/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="https://raindays.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  心情小镇
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Mood" target="_blank" rel="noopener noreferrer" class="nav-link external">
  全栈项目
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/after/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="https://raindays.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  心情小镇
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Mood" target="_blank" rel="noopener noreferrer" class="nav-link external">
  全栈项目
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue 原理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/vue/9.html" class="sidebar-link">生命周期</a></li><li><a href="/web/vue/1.html" class="sidebar-link">new Vue 发生了什么</a></li><li><a href="/web/vue/2.html" class="sidebar-link">Virtual DOM</a></li><li><a href="/web/vue/3.html" class="sidebar-link">Diff算法</a></li><li><a href="/web/vue/4.html" class="sidebar-link">响应式原理</a></li><li><a href="/web/vue/5.html" class="sidebar-link">nextTick</a></li><li><a href="/web/vue/6.html" class="sidebar-link">Computed 和 Watch</a></li><li><a href="/web/vue/7.html" class="sidebar-link">$set() 实时更新</a></li><li><a href="/web/vue/8.html" class="sidebar-link">hash和history路由实现原理</a></li><li><a href="/web/vue/10.html" class="active sidebar-link">props</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/vue/10.html#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header"><a href="/web/vue/10.html#更新" class="sidebar-link">更新</a></li><li class="sidebar-sub-header"><a href="/web/vue/10.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/web/vue/20.html" class="sidebar-link">一句话说明</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue 方法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Base</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DOM、BOM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Array</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Object</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>String</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Async</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Browser</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>正则</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="props"><a href="#props" class="header-anchor">#</a> props</h1> <p>这一次，通过源码阅读，主要探索的方面包括如何初始化 Props、以及如何进行更新。</p> <h2 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>_watchers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initProps</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> propsOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> propsData <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 获取Vue实例选项上的Props</span>
    <span class="token keyword">var</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 获取挂载Vue实例上的_props</span>
    <span class="token keyword">var</span> keys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Props的Key值组成的数组</span>
    <span class="token comment">// ...</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> propsOptions<span class="token punctuation">)</span> <span class="token function">loop</span><span class="token punctuation">(</span> key <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 循环遍历 vue 实例选项中Props，并且执行响应式处理以及挂载在对应实例上</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>初始化 Props 的关键点就在于loop函数，让我们接着该函数做了什么事情。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> sharedPropertyDefinition <span class="token operator">=</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span><span class="token operator">:</span> noop<span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token operator">:</span> noop
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">proxy</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> sourceKey<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxyGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxySetter</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">key</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每遍历一次Props中的值，都会收集其Key</span>
  <span class="token comment">// ...</span>
  <span class="token function">defineReactive$$1</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 将Vue实例上对象的_props中每一项属性都设置响应式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isUpdatingChildComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 配置的Setter函数，避免子组件直接操作Props的警告</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">&quot;Avoid mutating a prop directly since the value will be &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;overwritten whenever the parent component re-renders. &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;Instead, use a data or computed property based on the prop's &quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;value. Prop being mutated: \&quot;&quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;\&quot;&quot;</span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// static props are already proxied on the component's prototype</span>
  <span class="token comment">// during Vue.extend(). We only need to proxy props defined at</span>
  <span class="token comment">// instantiation here.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 遍历时若发现新属性时，就将新属性重新挂载到Vue实例的_props中</span>
    <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">&quot;_props&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>理解上应该不会有太大的问题，loop函数中主要做了以下几件事：</p> <ul><li>defineReactive</li></ul> <p>相信对这个函数应该都不会陌生，其实就是对Vue实例上的<code>_props</code>对象中每一个属性都配置成响应式的，这样一来，当父组件中传递进来的 <code>Props</code> 变化时，则会通知相应的子组件中更新函数进行更新；</p> <ul><li>对相应的子组件配置Props属性的Setter警告函数</li></ul> <p>用过Vue的童鞋们应该都会遇到直接更改一个 <code>Props</code> 中的属性时，会抛出一个警告。而这个警告就是在 Vue 遍历 <code>_props</code> 对象中的值时，都会默认配置一个警告 <code>Setter</code> 函数；</p> <ul><li>proxy</li></ul> <p>在遍历的过程中，一旦发现有新的属性时，都会将新属性重新挂载到 Vue 实例的 <code>_props</code> 中。这里有一个很重要的知识点，<strong>当我们直接访问一个 Props 中的属性时，即上面栗子中<code>this.name</code>，其实是直接访问了 Vue 实例的 <code>_props</code> 对象中值而已。</strong></p> <p>至此，我们也知道 Vue 源码是如何实现初始化 Props 的了，那么，究竟是父组件是如何通知更新 Props 的呢？我们接着看下去。</p> <h2 id="更新"><a href="#更新" class="header-anchor">#</a> 更新</h2> <p>由于父组件在更新的过程中，会通知子组件也进行更新，这时候就会调取一个方法<code>updateChildComponent</code>，而这个方法里就会对 <code>Props</code> 进行更新。我们就来看看是如何处理的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">updateChildComponent</span><span class="token punctuation">(</span>
  child<span class="token punctuation">,</span>
  options<span class="token punctuation">.</span>propsData<span class="token punctuation">,</span> <span class="token comment">// updated props</span>
  options<span class="token punctuation">.</span>listeners<span class="token punctuation">,</span> <span class="token comment">// updated listeners</span>
  vnode<span class="token punctuation">,</span> <span class="token comment">// new parent vnode</span>
  options<span class="token punctuation">.</span>children <span class="token comment">// new children</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">updateChildComponent</span> <span class="token punctuation">(</span>
 <span class="token parameter">vm<span class="token punctuation">,</span>
 propsData<span class="token punctuation">,</span>
 listeners<span class="token punctuation">,</span>
 parentVnode<span class="token punctuation">,</span>
 renderChildren</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// ...</span>
   <span class="token comment">// update props</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>propsData <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭依赖监听</span>
     <span class="token keyword">var</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props<span class="token punctuation">;</span> <span class="token comment">// 获取Vue实例上_props对象</span>
     <span class="token keyword">var</span> propKeys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 获取保留在Vue实例上的props key值</span>
     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> propKeys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 循环遍历props key</span>
       <span class="token keyword">var</span> key <span class="token operator">=</span> propKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token keyword">var</span> propOptions <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props<span class="token punctuation">;</span> <span class="token comment">// wtf flow?</span>
       props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先校验Props中定义的数据类型是否符合，符合的话就直接返回，并且直接赋值给Vue实例上_props对象中相应的属性中</span>
     <span class="token punctuation">}</span>
     <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打开依赖监听</span>
     <span class="token comment">// keep a copy of raw propsData</span>
     vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">=</span> propsData<span class="token punctuation">;</span> <span class="token comment">// 新的PropsData直接取替掉选项中旧的PropsData</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// ...</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>一开始看到这里代码时，我是懵逼状态的，因为很容易绕不出来 😂。。在这里面会有几个问题，分别是：</p> <ul><li>validateProp 作用究竟是什么？</li></ul> <p>相信用过 Props 的同学都清楚，在传递给子组件时，子组件中是有权限决定传递的值类型的，大大提高传递的规范，举个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code>props<span class="token operator">:</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    required<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码很好理解，就是规定 <code>name</code> 属性的类型以及是否必传。而方法<code>validateProp</code>作用就是校验父组件传递给子组件的值是否按要求传递，若正确传递则直接赋值给 <code>_props</code> 对象上相应的属性。</p> <ul><li>校验通过后，直接赋值给 <code>_props</code> 对象上相应的属性的用意何在？</li></ul> <p>上面提到过，<code>_props</code> 对象上的每一个属性都会使用 <code>proxy</code> 方法进行响应式挂载。那么当我直接赋值到 <code>_props</code> 对象上相应的属性时，就会触发到其 <code>Setter</code> 函数进行相应的依赖更新。因此，当父组件更新一个传递到子组件的属性时，首先会触发其 <code>Setter</code> 函数通知父组件进行更新，然后通过渲染函数传递到子组件后，更新子组件中的 <code>Props</code>。这时候，由于此时的 <code>Props</code> 对象中的属性收集到了子组件的依赖，更改后会通知相应的依赖进行更新。</p> <ul><li>toggleObserving 究竟是干嘛用的？</li></ul> <p>首先它是一个递归遍历方法，<strong><code>Props</code> 在通知子组件依赖更新时，必须搞清楚的一点，就是是整个值的变化来进行通知</strong>。如何理解？</p> <p>简单滴说，对于属性值为基本数据类型的，当值改变时，是可以直接通知子组件进行更新的，而对于复杂数据类型来说，在更新时，会递归遍历其对象内部的属性来通知相应的依赖进行更新。</p> <p>那么当调用方法<code>toggleObserving</code>为 false 时，对于基础数据类型来说，当其值变化时则直接通知子组件更新，而对于其复杂数据类型来说，则不会递归下去，而只会监听整个复杂数据类型替换时，才会去通知子组件进行更新。因此在 <code>Props</code> 中所有属性通知完后，又会重新调用方法toggleObserving为 true 来打开递归开关。（真的不得不服尤大大啊，这么好的优化思路都能想出来，牛人 👍）</p> <p>至此，你大概也知道整个更新流程了，但是我当时还是存在疑惑的，既然基础数据类型值更改或复杂数据类型整个值更改，可以直接通知到子组件进行更新，那么是否会有一种情况就是，复杂数据类型中属性更改时，又是如何通知子组件更新的呢？？🤔</p> <p>首先，我们一开始已经忽略一个方法，那就是defineReactive$$1，这个方法真的用的秒，可以看看上面的代码，在初始化 Props 时候，会对 Props 每一项的属性进行使用该方法进行响应式的处理，包括了复杂数据类型的中属性，此时该属性不但收集了父组件依赖，还收集了子组件的依赖，这样一来，当复杂数据类型中属性变化时，会先通知父组件更新，再通知子组件进行更新。（这时候我真的不得不服到五体投地。。。）</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ul><li>当 Props 中属性为基础数据类型值更改或复杂数据类型替换时，会通过 Setter 函数通知父组件进行更新，然后通过渲染函数，传递到子组件中更新其 Props 中对象相应的值，这时候就会触发到相应值的 Setter 来通知子组件进行更新；</li> <li>当 Props 中属性为复杂数据类型的属性更改时，由于使用defineReactive$$1方法收集到了父组件依赖以及子组件的依赖，这时候会先通知父组件进行更新，再通知子组件进行更新；</li></ul> <p>参考:</p> <ul><li><a href="https://ustbhuangyi.github.io/vue-analysis/v2/reactive/props.html" target="_blank" rel="noopener noreferrer">Vue.js 技术揭秘 props<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/Andraw-lin/about-Vue/blob/master/docs/%E3%80%90%20Vue%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E3%80%91%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E4%B9%8B%20Props.md" target="_blank" rel="noopener noreferrer">【 Vue 源码分析 】运行机制之 Props<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web/vue/8.html" class="prev">
        hash和history路由实现原理
      </a></span> <span class="next"><a href="/web/vue/20.html">
        一句话说明
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.17eeb65b.js" defer></script><script src="/assets/js/2.d133068f.js" defer></script><script src="/assets/js/136.7ab11e16.js" defer></script>
  </body>
</html>
