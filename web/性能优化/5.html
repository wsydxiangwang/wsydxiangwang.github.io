<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WEB安全 | 不吃茶的v李白</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/images/photo.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="Live and Study.">
    <meta name="theme-color" content="#0084ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/images/photo">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.db326a3d.css" as="style"><link rel="preload" href="/assets/js/app.5e38ef59.js" as="script"><link rel="preload" href="/assets/js/2.97a53aa9.js" as="script"><link rel="preload" href="/assets/js/22.7db22560.js" as="script"><link rel="prefetch" href="/assets/js/10.dcf4c353.js"><link rel="prefetch" href="/assets/js/100.d5f09228.js"><link rel="prefetch" href="/assets/js/101.013d4626.js"><link rel="prefetch" href="/assets/js/102.d0acfcfb.js"><link rel="prefetch" href="/assets/js/103.9a0181c9.js"><link rel="prefetch" href="/assets/js/104.dbdfdac7.js"><link rel="prefetch" href="/assets/js/105.dc49b0bd.js"><link rel="prefetch" href="/assets/js/106.e8cc9fc1.js"><link rel="prefetch" href="/assets/js/107.56a2b7fb.js"><link rel="prefetch" href="/assets/js/108.5df71e18.js"><link rel="prefetch" href="/assets/js/109.3a63eafc.js"><link rel="prefetch" href="/assets/js/11.c4dd4bed.js"><link rel="prefetch" href="/assets/js/110.adc3338f.js"><link rel="prefetch" href="/assets/js/111.8210fc76.js"><link rel="prefetch" href="/assets/js/112.bff45079.js"><link rel="prefetch" href="/assets/js/113.6be99820.js"><link rel="prefetch" href="/assets/js/12.b4fbb96a.js"><link rel="prefetch" href="/assets/js/13.7c881a52.js"><link rel="prefetch" href="/assets/js/14.4ed02a43.js"><link rel="prefetch" href="/assets/js/15.265c101c.js"><link rel="prefetch" href="/assets/js/16.906321ef.js"><link rel="prefetch" href="/assets/js/17.42cc2e36.js"><link rel="prefetch" href="/assets/js/18.25c64695.js"><link rel="prefetch" href="/assets/js/19.8001a709.js"><link rel="prefetch" href="/assets/js/20.40cd6832.js"><link rel="prefetch" href="/assets/js/21.422c524a.js"><link rel="prefetch" href="/assets/js/23.7e57d7fa.js"><link rel="prefetch" href="/assets/js/24.f8cb2a61.js"><link rel="prefetch" href="/assets/js/25.af6443ed.js"><link rel="prefetch" href="/assets/js/26.52908379.js"><link rel="prefetch" href="/assets/js/27.3bd61421.js"><link rel="prefetch" href="/assets/js/28.8a39e1eb.js"><link rel="prefetch" href="/assets/js/29.10ee8016.js"><link rel="prefetch" href="/assets/js/3.7d8bef29.js"><link rel="prefetch" href="/assets/js/30.3dd40517.js"><link rel="prefetch" href="/assets/js/31.03275af0.js"><link rel="prefetch" href="/assets/js/32.0d752ed8.js"><link rel="prefetch" href="/assets/js/33.1140199a.js"><link rel="prefetch" href="/assets/js/34.dd288bee.js"><link rel="prefetch" href="/assets/js/35.d109a221.js"><link rel="prefetch" href="/assets/js/36.43f309ad.js"><link rel="prefetch" href="/assets/js/37.45fa1ae9.js"><link rel="prefetch" href="/assets/js/38.274113de.js"><link rel="prefetch" href="/assets/js/39.0030c2e2.js"><link rel="prefetch" href="/assets/js/4.c510a863.js"><link rel="prefetch" href="/assets/js/40.06f1ded9.js"><link rel="prefetch" href="/assets/js/41.a9d5d598.js"><link rel="prefetch" href="/assets/js/42.ebb4a599.js"><link rel="prefetch" href="/assets/js/43.ae315192.js"><link rel="prefetch" href="/assets/js/44.659ab12f.js"><link rel="prefetch" href="/assets/js/45.6158f93d.js"><link rel="prefetch" href="/assets/js/46.9553bc7e.js"><link rel="prefetch" href="/assets/js/47.24a01113.js"><link rel="prefetch" href="/assets/js/48.1c4616e5.js"><link rel="prefetch" href="/assets/js/49.fc9bf987.js"><link rel="prefetch" href="/assets/js/5.23cd88df.js"><link rel="prefetch" href="/assets/js/50.407a93f3.js"><link rel="prefetch" href="/assets/js/51.aae6cc44.js"><link rel="prefetch" href="/assets/js/52.ac0da788.js"><link rel="prefetch" href="/assets/js/53.15a1bf24.js"><link rel="prefetch" href="/assets/js/54.91ebab9c.js"><link rel="prefetch" href="/assets/js/55.1f5f720b.js"><link rel="prefetch" href="/assets/js/56.080b2ee5.js"><link rel="prefetch" href="/assets/js/57.7b6c3f0f.js"><link rel="prefetch" href="/assets/js/58.84cf0828.js"><link rel="prefetch" href="/assets/js/59.cefc33c8.js"><link rel="prefetch" href="/assets/js/6.771f86e0.js"><link rel="prefetch" href="/assets/js/60.63e88fa8.js"><link rel="prefetch" href="/assets/js/61.c63c1bb2.js"><link rel="prefetch" href="/assets/js/62.84af953a.js"><link rel="prefetch" href="/assets/js/63.445a5766.js"><link rel="prefetch" href="/assets/js/64.3af7f0ef.js"><link rel="prefetch" href="/assets/js/65.c1a4eb22.js"><link rel="prefetch" href="/assets/js/66.96bb7c0e.js"><link rel="prefetch" href="/assets/js/67.25dd973f.js"><link rel="prefetch" href="/assets/js/68.6d273358.js"><link rel="prefetch" href="/assets/js/69.6e92fb34.js"><link rel="prefetch" href="/assets/js/7.b27240dc.js"><link rel="prefetch" href="/assets/js/70.09caea64.js"><link rel="prefetch" href="/assets/js/71.ac25a4dd.js"><link rel="prefetch" href="/assets/js/72.92ff6d6b.js"><link rel="prefetch" href="/assets/js/73.e3a2e52d.js"><link rel="prefetch" href="/assets/js/74.65261390.js"><link rel="prefetch" href="/assets/js/75.a9057ae9.js"><link rel="prefetch" href="/assets/js/76.09073b6d.js"><link rel="prefetch" href="/assets/js/77.ed1b10d4.js"><link rel="prefetch" href="/assets/js/78.4b2a83ed.js"><link rel="prefetch" href="/assets/js/79.1d46c44c.js"><link rel="prefetch" href="/assets/js/8.dcc2e69d.js"><link rel="prefetch" href="/assets/js/80.1bcb0381.js"><link rel="prefetch" href="/assets/js/81.01f51007.js"><link rel="prefetch" href="/assets/js/82.838df9f0.js"><link rel="prefetch" href="/assets/js/83.aa48cd8d.js"><link rel="prefetch" href="/assets/js/84.87da90bd.js"><link rel="prefetch" href="/assets/js/85.d41d9e87.js"><link rel="prefetch" href="/assets/js/86.7aeea46b.js"><link rel="prefetch" href="/assets/js/87.35f82ace.js"><link rel="prefetch" href="/assets/js/88.05bf72f7.js"><link rel="prefetch" href="/assets/js/89.407aee92.js"><link rel="prefetch" href="/assets/js/9.10f27efa.js"><link rel="prefetch" href="/assets/js/90.13fcc480.js"><link rel="prefetch" href="/assets/js/91.658107a6.js"><link rel="prefetch" href="/assets/js/92.1c086b75.js"><link rel="prefetch" href="/assets/js/93.940197a5.js"><link rel="prefetch" href="/assets/js/94.353ddc7f.js"><link rel="prefetch" href="/assets/js/95.310160cc.js"><link rel="prefetch" href="/assets/js/96.904274c6.js"><link rel="prefetch" href="/assets/js/97.2687245b.js"><link rel="prefetch" href="/assets/js/98.5c8e156d.js"><link rel="prefetch" href="/assets/js/99.132de7df.js">
    <link rel="stylesheet" href="/assets/css/0.styles.db326a3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">不吃茶的v李白</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/after/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="https://raindays.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  心情小镇
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Mood" target="_blank" rel="noopener noreferrer" class="nav-link external">
  全栈项目
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  Web
</a></div><div class="nav-item"><a href="/other/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/after/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="https://raindays.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  心情小镇
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Mood" target="_blank" rel="noopener noreferrer" class="nav-link external">
  全栈项目
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wsydxiangwang/Note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS 深入数组</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS 对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS 字符串</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>this 闭包 原型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>异步方法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>性能优化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/性能优化/1.html" class="sidebar-link">节流防抖</a></li><li><a href="/web/性能优化/2.html" class="sidebar-link">图片懒加载</a></li><li><a href="/web/性能优化/3.html" class="sidebar-link">前端缓存</a></li><li><a href="/web/性能优化/4.html" class="sidebar-link">本地存储</a></li><li><a href="/web/性能优化/5.html" class="active sidebar-link">WEB安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/性能优化/5.html#csrf" class="sidebar-link">CSRF</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/性能优化/5.html#防范措施" class="sidebar-link">防范措施</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/性能优化/5.html#xss" class="sidebar-link">XSS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/性能优化/5.html#存储型" class="sidebar-link">存储型</a></li><li class="sidebar-sub-header"><a href="/web/性能优化/5.html#反射型" class="sidebar-link">反射型</a></li><li class="sidebar-sub-header"><a href="/web/性能优化/5.html#文档型" class="sidebar-link">文档型</a></li><li class="sidebar-sub-header"><a href="/web/性能优化/5.html#防范措施-2" class="sidebar-link">防范措施</a></li></ul></li></ul></li><li><a href="/web/性能优化/6.html" class="sidebar-link">Script的加载和执行</a></li><li><a href="/web/性能优化/7.html" class="sidebar-link">防抖多列表的骚操作</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>稀奇古怪的题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>正则</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="web安全"><a href="#web安全" class="header-anchor">#</a> WEB安全</h1> <p>前端安全分两类：CSRF、XSS</p> <h2 id="csrf"><a href="#csrf" class="header-anchor">#</a> CSRF</h2> <p>CSRF(Cross-site request forgery), 即跨站请求伪造。指的是黑客诱导用户点击链接，打开黑客的网站，然后黑客利用用户<strong>目前的登录状态</strong>发起跨站请求。</p> <p>要完成一次CSRF攻击，受害者必须依次完成两个步骤：</p> <ol><li>受害者登录A站点，并保留了登录凭证（Cookie）。</li> <li>攻击者诱导受害者访问了站点B。</li> <li>站点B向站点A发送了一个请求，浏览器会默认携带站点A的Cookie信息。</li> <li>站点A接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是无辜的受害者发送的请求。</li> <li>站点A以受害者的名义执行了站点B的请求。</li> <li>攻击完成，攻击者在受害者不知情的情况下，冒充受害者完成了攻击。</li> <li>跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等(来源不明的链接，不要点击)</li></ol> <p><img src="/assets/img/csrf.ac0fe4e8.png" alt=""></p> <h3 id="防范措施"><a href="#防范措施" class="header-anchor">#</a> 防范措施</h3> <ol><li>Cookie的SameSite属性</li></ol> <p>CSRF攻击中重要的一环就是自动发送目标站点下的<code>Cookie</code>,然后就是这一份<code>Cookie</code>模拟了用户的身份。因此在<code>Cookie</code>上面下文章是防范的不二之选。</p> <p><code>SameSite</code>可以设置为三个值，<code>Strict</code>、<code>Lax</code>和<code>None</code>。</p> <ul><li>在<code>Strict</code>模式下，浏览器完全禁止第三方请求携带<code>Cookie</code>。比如请求<code>sanyuan.com</code>网站只能在<code>sanyuan.com</code>域名当中请求才能携带 <code>Cookie</code>，在其他网站请求都不能。</li> <li>在<code>Lax</code>模式，就宽松一点了，但是只能在<code>get</code>方法提交表单况或者a标签发送<code>get</code>请求的情况下可以携带<code>Cookie</code>，其他情况均不能。</li> <li>在<code>None</code>模式下，也就是默认模式，请求会自动携带上 Cookie。</li></ul> <ol start="2"><li>Token验证(主流)</li></ol> <ul><li>服务端给用户生成一个<code>token</code>，加密后传递给用户</li> <li>用户在提交请求时，需要携带这个<code>token</code></li> <li>服务端验证<code>token</code>是否正确</li></ul> <ol start="3"><li>Referer 验证</li></ol> <p><code>Referer</code> 可以作为一种辅助手段，来判断请求的来源是否是安全的，但是鉴于 <code>Referer</code> 本身是可以被修改的，因此不能仅依赖于  <code>Referer</code></p> <h2 id="xss"><a href="#xss" class="header-anchor">#</a> XSS</h2> <p>XSS(Cross-Site Scripting，跨站脚本攻击)是一种代码注入攻击。攻击者在目标网站上注入恶意代码，当被攻击者登陆网站时就会执行这些恶意代码，这些脚本可以读取 cookie，session tokens，或者其它敏感的网站信息，对用户进行钓鱼欺诈，甚至发起蠕虫攻击等。</p> <p>这些操作一般可以完成下面这些事情:</p> <ol><li>窃取Cookie。</li> <li>监听用户行为，比如输入账号密码后直接发送到黑客服务器。</li> <li>修改 DOM 伪造登录表单。</li> <li>在页面中生成浮窗广告。</li></ol> <p>通常情况，XSS 攻击的实现有三种方式——<strong>存储型、反射型和文档型</strong>。原理都比较简单，先来一一介绍一下。</p> <h3 id="存储型"><a href="#存储型" class="header-anchor">#</a> 存储型</h3> <p><code>存储型</code>，顾名思义就是将恶意脚本存储了起来，确实，存储型的 XSS 将脚本存储到了服务端的数据库，然后在客户端执行这些脚本，从而达到攻击的效果。</p> <p>常见的场景是留言评论区提交一段脚本代码，如果前后端没有做好转义的工作，那评论内容存到了数据库，在页面渲染过程中<code>直接执行</code>, 相当于执行一段未知逻辑的 JS 代码，是非常恐怖的。这就是存储型的 XSS 攻击。</p> <h3 id="反射型"><a href="#反射型" class="header-anchor">#</a> 反射型</h3> <p><code>反射型XSS</code>指的是恶意脚本作为<strong>网络请求的一部分</strong>。</p> <p>比如我输入:</p> <div class="language- extra-class"><pre class="language-text"><code>http://sanyuan.com?q=&lt;script&gt;alert(&quot;你完蛋了&quot;)&lt;/script&gt;
</code></pre></div><p>这样，在服务器端会拿到<code>q</code>参数,然后将内容返回给浏览器端，浏览器将这些内容作为HTML的一部分解析，发现是一个脚本，直接执行，这样就被攻击了。</p> <p>之所以叫它<code>反射型</code>, 是因为恶意脚本是通过作为网络请求的参数，经过服务器，然后再反射到HTML文档中，执行解析。和<code>存储型</code>不一样的是，服务器并不会存储这些恶意脚本。</p> <h3 id="文档型"><a href="#文档型" class="header-anchor">#</a> 文档型</h3> <p>文档型的 XSS 攻击并不会经过服务端，而是作为中间人的角色，在数据传输过程劫持到网络数据包，然后修改里面的 html 文档！</p> <p>DOM 型 XSS 攻击，实际上就是前端<code>JavaScript</code>代码不够严谨，把不可信的内容插入到了页面。在使用 <code>.innerHTML</code>、<code>.outerHTML</code>、<code>.appendChild</code>、<code>document.write()</code>等API时要特别小心，不要把不可信的数据作为 HTML 插到页面上，尽量使用<code>.innerText</code>、<code>.textContent</code>、<code>.setAttribute()</code>等。</p> <h3 id="防范措施-2"><a href="#防范措施-2" class="header-anchor">#</a> 防范措施</h3> <p>明白了三种XSS攻击的原理，我们能发现一个共同点: <strong>都是让恶意脚本直接能在浏览器中执行</strong>。</p> <p>那么要防范它，就是要避免这些脚本代码的执行。</p> <ol><li>无论是在前端和服务端，都要对用户的输入进行转码或者过滤。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">escape</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&amp;/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&lt;/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&gt;/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&quot;/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;quto;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/'/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;##39;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/`/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;##96;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\//g</span><span class="token punctuation">,</span> <span class="token string">'&amp;##x2F;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 通过转义，将攻击代码变成</span>
<span class="token function">escape</span><span class="token punctuation">(</span><span class="token string">'&lt;script&gt;alert(1)&lt;/script&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &amp;lt;script&amp;gt;alert(1)&amp;lt;&amp;##x2F;script&amp;gt;</span>
</code></pre></div><p>当然也可以利用关键词过滤的方式，将 script 标签给删除。那么现在的内容只剩下:什么也没有了:）</p> <ol start="2"><li>HttpOnly</li></ol> <p>很多XSS攻击脚本都是用来窃取<code>Cookie</code>, 而设置<code>Cookie</code>的<code>HttpOnly</code>属性后，JavaScript便无法读取<code>Cookie</code>的值。这样也能很好的防范XSS攻击。</p> <ol start="3"><li>CSP</li></ol> <p>在服务端使用 HTTP的<code>Content-Security-Policy</code>头部来指定策略，或者在前端设置<code>meta</code>标签。</p> <p>例如下面的配置只允许加载同域下的资源：</p> <div class="language-html extra-class"><pre class="language-html"><code>Content-Security-Policy: default-src 'self'

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Content-Security-Policy<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>form-action 'self';<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>严格的 CSP 在 XSS 的防范中可以起到以下的作用：</p> <ul><li>限制其他域下的资源加载。</li> <li>禁止向其它域提交数据。</li> <li>禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）。</li> <li>禁止未授权的脚本执行（新特性，Google Map 移动版在使用）。</li> <li>合理使用上报可以及时发现 XSS，利于尽快修复问题。</li></ul> <ol start="4"><li>对于url链接(例如图片的src属性)，那么直接使用<code>encodeURIComponent</code>来转义。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web/性能优化/4.html" class="prev">
        本地存储
      </a></span> <span class="next"><a href="/web/性能优化/6.html">
        Script的加载和执行
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5e38ef59.js" defer></script><script src="/assets/js/2.97a53aa9.js" defer></script><script src="/assets/js/22.7db22560.js" defer></script>
  </body>
</html>
